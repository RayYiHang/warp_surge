# Warp Account Manager - 本地后台使用指南

## 🎯 快速开始

### 方法1: 使用本地HTML文件（推荐）

1. **下载管理界面**：
   - 下载 `web-manager.html` 文件到本地
   - 或直接访问：`https://raw.githubusercontent.com/RayYiHang/warp_surge/refs/heads/main/web-manager.html`

2. **打开管理界面**：
   - 双击打开 `web-manager.html` 文件
   - 或在浏览器中打开下载的文件

3. **开始管理**：
   - 按照界面提示操作
   - 复制命令到Surge控制台执行

### 方法2: Surge控制台直接操作

1. **打开Surge控制台**：
   - 设置 → 脚本编辑器

2. **执行管理命令**：
   ```javascript
   // 查看账户列表
   accountManager.getAccountList()

   // 添加账户
   accountManager.addAccount({
     "email": "your-email@example.com",
     "stsTokenManager": {
       "accessToken": "...",
       "refreshToken": "...",
       "expirationTime": 1234567890000
     }
   })

   // 切换账户
   accountManager.setActiveAccount("your-email@example.com")
   ```

## 🔧 域名访问配置

虽然不能直接运行HTTP服务器，但可以通过以下方式模拟：

### 配置本地域名
在Surge模块中已配置：
```
[Host]
127.0.0.1 warp.local
127.0.0.1 warp-manager.local
```

### 访问方式
- 直接打开 `web-manager.html` 文件
- 或通过本地文件服务器访问

## 📱 完整功能列表

### 1. 账户管理
- ✅ 添加新账户
- ✅ 查看账户列表
- ✅ 切换活跃账户
- ✅ 删除账户
- ✅ 账户状态监控

### 2. 数据管理
- ✅ 数据备份
- ✅ 数据恢复
- ✅ 统计信息查看
- ✅ 设置管理

### 3. 系统工具
- ✅ 系统测试
- ✅ 健康检查
- ✅ 命令生成器
- ✅ 使用帮助

## 🚀 使用流程

### 第一步：获取账户数据
1. 登录 https://app.warp.dev
2. 按 `F12` 打开开发者工具
3. 点击 `Application` → `Storage` → `Local Storage` → `https://app.warp.dev`
4. 复制包含 `email` 和 `stsTokenManager` 的数据

### 第二步：添加账户
1. 打开管理界面
2. 在"账户管理"标签页粘贴数据
3. 点击"添加账户"
4. 复制生成的命令到Surge控制台执行

### 第三步：切换账户
1. 在管理界面点击"切换账户"
2. 输入要切换的邮箱
3. 复制命令到Surge控制台执行

## 🔍 获取账户数据的详细方法

### Chrome开发者工具方法
```javascript
// 在Chrome控制台执行
const authData = JSON.parse(localStorage.getItem('authUser'));
console.log(JSON.stringify(authData, null, 2));
```

### Network请求方法
1. 开发者工具 → Network
2. 刷新页面
3. 找到包含Authorization的请求
4. 复制token信息

### 直接获取LocalStorage
1. Application → Local Storage → app.warp.dev
2. 查找包含用户信息的键值对
3. 手动构造JSON数据

## ⚡ 快速命令参考

### 基础操作
```javascript
// 获取所有账户
const accounts = accountManager.getAccountList();
console.log(accounts);

// 获取当前活跃账户
const activeAccount = accountManager.getActiveAccount();
console.log(activeAccount);

// 查看存储统计
const stats = persistenceManager.getStorageStats();
console.log(stats.stats);
```

### 账户操作
```javascript
// 添加账户
accountManager.addAccount({
  "email": "example@gmail.com",
  "stsTokenManager": {
    "accessToken": "token_here",
    "refreshToken": "refresh_here",
    "expirationTime": Date.now() + 3600000
  }
});

// 切换到指定账户
accountManager.setActiveAccount("example@gmail.com");

// 删除账户
accountManager.deleteAccount("example@gmail.com");
```

### 数据管理
```javascript
// 创建备份
const backup = persistenceManager.backupData();
console.log(backup.data);

// 恢复数据（需要备份数据）
const backupData = "..."; // 备份的JSON字符串
persistenceManager.restoreData(backupData);

// 清除所有数据
persistenceManager.clearAllData();
```

## 🛠️ 故障排除

### 1. 账户数据格式错误
**问题**：JSON格式不正确
**解决**：
```javascript
// 使用在线JSON验证工具
// 或在浏览器控制台验证
try {
  JSON.parse(yourData);
  console.log('格式正确');
} catch (error) {
  console.log('格式错误:', error.message);
}
```

### 2. Token过期
**问题**：Token已过期无法使用
**解决**：
- 重新获取账户数据
- 确保expirationTime是未来时间
- 检查refreshToken是否有效

### 3. Surge脚本未加载
**问题**：脚本执行时报错未定义
**解决**：
1. 确认模块已启用
2. 重启Surge
3. 检查脚本路径是否正确

### 4. 数据无法保存
**问题**：添加账户后数据丢失
**解决**：
1. 检查Surge的持久存储权限
2. 确认模块版本匹配
3. 重新安装模块

## 📊 高级功能

### 批量操作
```javascript
// 批量添加账户
const accounts = [
  {
    "email": "account1@example.com",
    "stsTokenManager": { /* token数据 */ }
  },
  {
    "email": "account2@example.com",
    "stsTokenManager": { /* token数据 */ }
  }
];

accounts.forEach(account => {
  accountManager.addAccount(account);
});
```

### 定时检查
```javascript
// 检查所有账户状态
setInterval(() => {
  const accounts = accountManager.getAccountList();
  accounts.forEach(account => {
    if (account.healthStatus === 'banned') {
      console.log(\`账户 \${account.email} 已被封禁\`);
    }
  });
}, 60000); // 每分钟检查一次
```

### 数据分析
```javascript
// 分析账户使用情况
const accounts = accountManager.getAccountList();
const bannedAccounts = accounts.filter(a => a.healthStatus === 'banned');
const healthyAccounts = accounts.filter(a => a.healthStatus === 'healthy');

console.log(\`总账户: \${accounts.length}\`);
console.log(\`健康账户: \${healthyAccounts.length}\`);
console.log(\`被封账户: \${bannedAccounts.length}\`);
console.log(\`健康率: \${(healthyAccounts.length / accounts.length * 100).toFixed(1)}%\`);
```

## 🎯 最佳实践

1. **定期备份**：每周备份一次账户数据
2. **Token监控**：定期检查token有效期
3. **状态检查**：监控账户健康状态
4. **安全存储**：不要在公共电脑保存账户数据
5. **及时更新**：保持模块为最新版本

## 📞 技术支持

如果遇到问题：
1. 查看Surge控制台错误信息
2. 检查模块是否正确安装
3. 确认账户数据格式正确
4. 参考GitHub仓库的Issue

---

**💡 提示**：虽然不能直接通过warp.local访问，但通过本地HTML文件的方式提供了相同的功能，而且更加安全和可控。